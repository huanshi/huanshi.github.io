(function(m){"function"===typeof bootstrap?bootstrap("promise",m):"object"===typeof exports?module.exports=m():"function"===typeof define&&define.amd?define(m):"undefined"!==typeof ses?ses.ok()&&(ses.makeQ=m):Q=m()})(function(){function m(a){return function(){return W.apply(a,arguments)}}function I(a,b){if(x&&b.stack&&"object"===typeof a&&null!==a&&a.stack&&-1===a.stack.indexOf(J)){for(var f=[],c=b;c;c=c.source)c.stack&&f.unshift(c.stack);f.unshift(a.stack);for(var f=f.join("\n"+J+"\n").split("\n"),
c=[],d=0;d<f.length;++d){var k=f[d],n;if(n=K(k)){var u=n[1];n=n[0]===L&&u>=X&&u<=Y}else n=!1;n||-1!==k.indexOf("(module.js:")||-1!==k.indexOf("(node.js:")||!k||c.push(k)}f=c.join("\n");a.stack=f}}function K(a){var b=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(a);if(b||(b=/at ([^ ]+):(\d+):(?:\d+)$/.exec(a)))return[b[1],Number(b[2])];if(a=/.*@(.+):(\d+)$/.exec(a))return[a[1],Number(a[2])]}function M(){if(x)try{throw Error();}catch(a){var b=a.stack.split("\n"),b=0<b[0].indexOf("@")?b[1]:b[2];if(b=K(b))return L=
b[0],b[1]}}function c(a){return r(a)?a:N(a)?Z(a):A(a)}function l(){function a(a){g=a;k.source=a;y(b,function(b,f){p(function(){a.promiseDispatch.apply(a,f)})},void 0);f=b=void 0}var b=[],f=[],g,h=C(l.prototype),k=C(d.prototype);k.promiseDispatch=function(a,c,d){var k=e(arguments);b?(b.push(k),"when"===c&&d[1]&&f.push(d[1])):p(function(){g.promiseDispatch.apply(g,k)})};k.valueOf=function(){if(b)return k;var a=O(g);r(a)&&(g=a);return a};k.inspect=function(){return g?g.inspect():{state:"pending"}};if(c.longStackSupport&&
x)try{throw Error();}catch(n){k.stack=n.stack.substring(n.stack.indexOf("\n")+1)}h.promise=k;h.resolve=function(b){g||a(c(b))};h.fulfill=function(b){g||a(A(b))};h.reject=function(b){g||a(q(b))};h.notify=function(a){g||y(f,function(b,f){p(function(){f(a)})},void 0)};return h}function P(a){if("function"!==typeof a)throw new TypeError("resolver must be a function.");var b=l();try{a(b.resolve,b.reject,b.notify)}catch(f){b.reject(f)}return b.promise}function d(a,b,f){void 0===b&&(b=function(a){return q(Error("Promise does not support operation: "+
a))});void 0===f&&(f=function(){return{state:"unknown"}});var c=C(d.prototype);c.promiseDispatch=function(f,d,h){var B;try{B=a[d]?a[d].apply(c,h):b.call(c,d,h)}catch(e){B=q(e)}f&&f(B)};if(c.inspect=f){var h=f();"rejected"===h.state&&(c.exception=h.reason);c.valueOf=function(){var a=f();return"pending"===a.state||"rejected"===a.state?c:a.value}}return c}function s(a,b,f,g){return c(a).then(b,f,g)}function O(a){if(r(a)){var b=a.inspect();if("fulfilled"===b.state)return b.value}return a}function r(a){return a===
Object(a)&&"function"===typeof a.promiseDispatch&&"function"===typeof a.inspect}function N(a){return a===Object(a)&&"function"===typeof a.then}function R(){for(var a=0;a<t.length;a++)console.warn("Unhandled rejection reason:",t[a])}function D(){t.length=0;z.length=0;E=!1;if(!v&&(v=!0,"undefined"!==typeof process&&process.on))process.on("exit",R)}function $(a,b){v&&(z.push(a),b&&"undefined"!==typeof b.stack?t.push(b.stack):t.push("(no stack) "+b),!E&&"undefined"!==typeof window&&window.console&&console.warn("[Q] Unhandled rejection reasons (should be empty):",
t),E=!0)}function q(a){var b=d({when:function(b){if(b&&v){var c=aa(z,this);-1!==c&&(z.splice(c,1),t.splice(c,1))}return b?b(a):this}},function(){return this},function(){return{state:"rejected",reason:a}});$(b,a);return b}function A(a){return d({when:function(){return a},get:function(b){return a[b]},set:function(b,c){a[b]=c},"delete":function(b){delete a[b]},post:function(b,c){return null===b||void 0===b?a.apply(void 0,c):a[b].apply(a,c)},apply:function(b,c){return a.apply(b,c)},keys:function(){return ba(a)}},
void 0,function(){return{state:"fulfilled",value:a}})}function Z(a){var b=l();p(function(){try{a.then(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}});return b.promise}function S(a,b,f){return c(a).spread(b,f)}function T(a,b,f){return c(a).dispatch(b,f)}function w(a){return s(a,function(a){var c=0,g=l();y(a,function(d,k,n){var e;r(k)&&"fulfilled"===(e=k.inspect()).state?a[n]=e.value:(++c,s(k,function(d){a[n]=d;0===--c&&g.resolve(a)},g.reject,function(a){g.notify({index:n,value:a})}))},void 0);
0===c&&g.resolve(a);return g.promise})}function U(a){return s(a,function(a){a=F(a,c);return s(w(F(a,function(a){return s(a,V,V)})),function(){return a})})}var x=!1;try{throw Error();}catch(ca){x=!!ca.stack}var X=M(),L,V=function(){},p=function(){function a(){for(;b.next;){b=b.next;var c=b.task;b.task=void 0;var f=b.domain;f&&(b.domain=void 0,f.enter());try{c()}catch(h){if(k)throw f&&f.exit(),setTimeout(a,0),f&&f.enter(),h;setTimeout(function(){throw h;},0)}f&&f.exit()}d=!1}var b={task:void 0,next:null},
c=b,d=!1,h=void 0,k=!1;p=function(a){c=c.next={task:a,domain:k&&process.domain,next:null};d||(d=!0,h())};if("undefined"!==typeof process&&process.nextTick)k=!0,h=function(){process.nextTick(a)};else if("function"===typeof setImmediate)h="undefined"!==typeof window?setImmediate.bind(window,a):function(){setImmediate(a)};else if("undefined"!==typeof MessageChannel){var e=new MessageChannel;e.port1.onmessage=function(){h=l;e.port1.onmessage=a;a()};var l=function(){e.port2.postMessage(0)},h=function(){setTimeout(a,
0);l()}}else h=function(){setTimeout(a,0)};return p}(),W=Function.call,e=m(Array.prototype.slice),y=m(Array.prototype.reduce||function(a,b){var c=0,d=this.length;if(1===arguments.length){do{if(c in this){b=this[c++];break}if(++c>=d)throw new TypeError;}while(1)}for(;c<d;c++)c in this&&(b=a(b,this[c],c));return b}),aa=m(Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1}),F=m(Array.prototype.map||function(a,b){var c=this,d=[];y(c,function(h,k,e){d.push(a.call(b,
k,e,c))},void 0);return d}),C=Object.create||function(a){function b(){}b.prototype=a;return new b},da=m(Object.prototype.hasOwnProperty),ba=Object.keys||function(a){var b=[],c;for(c in a)da(a,c)&&b.push(c);return b},ea=m(Object.prototype.toString),G;G="undefined"!==typeof ReturnValue?ReturnValue:function(a){this.value=a};var H;try{new Function("(function* (){ yield 1; })"),H=!0}catch(fa){H=!1}var J="From previous event:";c.resolve=c;c.nextTick=p;c.longStackSupport=!1;c.defer=l;l.prototype.makeNodeResolver=
function(){var a=this;return function(b,c){b?a.reject(b):2<arguments.length?a.resolve(e(arguments,1)):a.resolve(c)}};c.promise=P;c.passByCopy=function(a){return a};d.prototype.passByCopy=function(){return this};c.join=function(a,b){return c(a).join(b)};d.prototype.join=function(a){return c([this,a]).spread(function(a,c){if(a===c)return a;throw Error("Can't join: not the same: "+a+" "+c);})};c.race=function(a){return P(function(b,f){for(var d=0,h=a.length;d<h;d++)c(a[d]).then(b,f)})};d.prototype.race=
function(){return this.then(c.race)};c.makePromise=d;d.prototype.toString=function(){return"[object Promise]"};d.prototype.then=function(a,b,f){function d(b){try{return"function"===typeof a?a(b):b}catch(c){return q(c)}}function h(a){if("function"===typeof b){I(a,k);try{return b(a)}catch(c){return q(c)}}return q(a)}var k=this,e=l(),u=!1;p(function(){k.promiseDispatch(function(a){u||(u=!0,e.resolve(d(a)))},"when",[function(a){u||(u=!0,e.resolve(h(a)))}])});k.promiseDispatch(void 0,"when",[void 0,function(a){var b,
d=!1;try{b="function"===typeof f?f(a):a}catch(g){if(d=!0,c.onerror)c.onerror(g);else throw g;}d||e.notify(b)}]);return e.promise};c.when=s;d.prototype.thenResolve=function(a){return this.then(function(){return a})};c.thenResolve=function(a,b){return c(a).thenResolve(b)};d.prototype.thenReject=function(a){return this.then(function(){throw a;})};c.thenReject=function(a,b){return c(a).thenReject(b)};c.nearer=O;c.isPromise=r;c.isPromiseAlike=N;c.isPending=function(a){return r(a)&&"pending"===a.inspect().state};
d.prototype.isPending=function(){return"pending"===this.inspect().state};c.isFulfilled=function(a){return!r(a)||"fulfilled"===a.inspect().state};d.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state};c.isRejected=function(a){return r(a)&&"rejected"===a.inspect().state};d.prototype.isRejected=function(){return"rejected"===this.inspect().state};var t=[],z=[],E=!1,v=!0;c.resetUnhandledRejections=D;c.getUnhandledReasons=function(){return t.slice()};c.stopUnhandledRejectionTracking=
function(){D();"undefined"!==typeof process&&process.on&&process.removeListener("exit",R);v=!1};D();c.reject=q;c.fulfill=A;c.master=function(a){return d({isDef:function(){}},function(b,c){return T(a,b,c)},function(){return c(a).inspect()})};c.spread=S;d.prototype.spread=function(a,b){return this.all().then(function(b){return a.apply(void 0,b)},b)};c.async=function(a){return function(){function b(a,b){var e;if(H){try{e=c[a](b)}catch(l){return q(l)}return e.done?e.value:s(e.value,d,h)}try{e=c[a](b)}catch(m){return"[object StopIteration]"===
ea(m)||m instanceof G?m.value:q(m)}return s(e,d,h)}var c=a.apply(this,arguments),d=b.bind(b,"next"),h=b.bind(b,"throw");return d()}};c.spawn=function(a){c.done(c.async(a)())};c["return"]=function(a){throw new G(a);};c.promised=function(a){return function(){return S([this,w(arguments)],function(b,c){return a.apply(b,c)})}};c.dispatch=T;d.prototype.dispatch=function(a,b){var c=this,d=l();p(function(){c.promiseDispatch(d.resolve,a,b)});return d.promise};c.get=function(a,b){return c(a).dispatch("get",
[b])};d.prototype.get=function(a){return this.dispatch("get",[a])};c.set=function(a,b,d){return c(a).dispatch("set",[b,d])};d.prototype.set=function(a,b){return this.dispatch("set",[a,b])};c.del=c["delete"]=function(a,b){return c(a).dispatch("delete",[b])};d.prototype.del=d.prototype["delete"]=function(a){return this.dispatch("delete",[a])};c.mapply=c.post=function(a,b,d){return c(a).dispatch("post",[b,d])};d.prototype.mapply=d.prototype.post=function(a,b){return this.dispatch("post",[a,b])};c.send=
c.mcall=c.invoke=function(a,b){return c(a).dispatch("post",[b,e(arguments,2)])};d.prototype.send=d.prototype.mcall=d.prototype.invoke=function(a){return this.dispatch("post",[a,e(arguments,1)])};c.fapply=function(a,b){return c(a).dispatch("apply",[void 0,b])};d.prototype.fapply=function(a){return this.dispatch("apply",[void 0,a])};c["try"]=c.fcall=function(a){return c(a).dispatch("apply",[void 0,e(arguments,1)])};d.prototype.fcall=function(){return this.dispatch("apply",[void 0,e(arguments)])};c.fbind=
function(a){var b=c(a),d=e(arguments,1);return function(){return b.dispatch("apply",[this,d.concat(e(arguments))])}};d.prototype.fbind=function(){var a=this,b=e(arguments);return function(){return a.dispatch("apply",[this,b.concat(e(arguments))])}};c.keys=function(a){return c(a).dispatch("keys",[])};d.prototype.keys=function(){return this.dispatch("keys",[])};c.all=w;d.prototype.all=function(){return w(this)};c.allResolved=function(a,b,c){return function(){"undefined"!==typeof console&&"function"===
typeof console.warn&&console.warn(b+" is deprecated, use "+c+" instead.",Error("").stack);return a.apply(a,arguments)}}(U,"allResolved","allSettled");d.prototype.allResolved=function(){return U(this)};c.allSettled=function(a){return c(a).allSettled()};d.prototype.allSettled=function(){return this.then(function(a){return w(F(a,function(a){function d(){return a.inspect()}a=c(a);return a.then(d,d)}))})};c.fail=c["catch"]=function(a,b){return c(a).then(void 0,b)};d.prototype.fail=d.prototype["catch"]=
function(a){return this.then(void 0,a)};c.progress=function(a,b){return c(a).then(void 0,void 0,b)};d.prototype.progress=function(a){return this.then(void 0,void 0,a)};c.fin=c["finally"]=function(a,b){return c(a)["finally"](b)};d.prototype.fin=d.prototype["finally"]=function(a){a=c(a);return this.then(function(b){return a.fcall().then(function(){return b})},function(b){return a.fcall().then(function(){throw b;})})};c.done=function(a,b,d,g){return c(a).done(b,d,g)};d.prototype.done=function(a,b,d){var g=
function(a){p(function(){I(a,e);if(c.onerror)c.onerror(a);else throw a;})},e=a||b||d?this.then(a,b,d):this;"object"===typeof process&&process&&process.domain&&(g=process.domain.bind(g));e.then(void 0,g)};c.timeout=function(a,b,d){return c(a).timeout(b,d)};d.prototype.timeout=function(a,b){var c=l(),d=setTimeout(function(){c.reject(Error(b||"Timed out after "+a+" ms"))},a);this.then(function(a){clearTimeout(d);c.resolve(a)},function(a){clearTimeout(d);c.reject(a)},c.notify);return c.promise};c.delay=
function(a,b){void 0===b&&(b=a,a=void 0);return c(a).delay(b)};d.prototype.delay=function(a){return this.then(function(b){var c=l();setTimeout(function(){c.resolve(b)},a);return c.promise})};c.nfapply=function(a,b){return c(a).nfapply(b)};d.prototype.nfapply=function(a){var b=l();a=e(a);a.push(b.makeNodeResolver());this.fapply(a).fail(b.reject);return b.promise};c.nfcall=function(a){var b=e(arguments,1);return c(a).nfapply(b)};d.prototype.nfcall=function(){var a=e(arguments),b=l();a.push(b.makeNodeResolver());
this.fapply(a).fail(b.reject);return b.promise};c.nfbind=c.denodeify=function(a){var b=e(arguments,1);return function(){var d=b.concat(e(arguments)),g=l();d.push(g.makeNodeResolver());c(a).fapply(d).fail(g.reject);return g.promise}};d.prototype.nfbind=d.prototype.denodeify=function(){var a=e(arguments);a.unshift(this);return c.denodeify.apply(void 0,a)};c.nbind=function(a,b){var d=e(arguments,2);return function(){var g=d.concat(e(arguments)),h=l();g.push(h.makeNodeResolver());c(function(){return a.apply(b,
arguments)}).fapply(g).fail(h.reject);return h.promise}};d.prototype.nbind=function(){var a=e(arguments,0);a.unshift(this);return c.nbind.apply(void 0,a)};c.nmapply=c.npost=function(a,b,d){return c(a).npost(b,d)};d.prototype.nmapply=d.prototype.npost=function(a,b){var c=e(b||[]),d=l();c.push(d.makeNodeResolver());this.dispatch("post",[a,c]).fail(d.reject);return d.promise};c.nsend=c.nmcall=c.ninvoke=function(a,b){var d=e(arguments,2),g=l();d.push(g.makeNodeResolver());c(a).dispatch("post",[b,d]).fail(g.reject);
return g.promise};d.prototype.nsend=d.prototype.nmcall=d.prototype.ninvoke=function(a){var b=e(arguments,1),c=l();b.push(c.makeNodeResolver());this.dispatch("post",[a,b]).fail(c.reject);return c.promise};c.nodeify=function(a,b){return c(a).nodeify(b)};d.prototype.nodeify=function(a){if(a)this.then(function(b){p(function(){a(null,b)})},function(b){p(function(){a(b)})});else return this};var Y=M();return c});
